<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Carrinho - Ki-Sucesso</title>
<link rel="stylesheet" href="Style.css">
</head>
<body>

<div class="topbar">
    <div class="left-icons">
        <i id="btnMenu">â˜°</i>
        
    </div>
    <div class="logo">
    <a href="index.html">
        <img src="logo.png" alt="Logo Ki-Sucesso">
    </a>
</div>
    <a href="carrinho.html" class="cart">ğŸ›’</a>
</div>

<div class="menu-lateral" id="menu">
    <div class="menu-top">
        <h2>Menu</h2>
        <span id="btnClose">âœ–</span>
    </div>
    <a href="index.html">ğŸ  InÃ­cio</a>
    <a href="produtos.html">ğŸ›’ Produtos</a>
    <a href="carrinho.html">ğŸ› Meu Carrinho</a>
    <a href="sobre.html">â„¹ï¸ Sobre NÃ³s</a>
    <a href="contato.html">â˜ï¸ Contato</a>
</div>
<div class="menu-backdrop" id="backdrop"></div>

<main style="max-width:1200px;margin:22px auto;padding:16px;">
    <h2>Meu Carrinho</h2>
    <div id="cart-list" style="margin-top:12px;"></div>

    <div id="cart-summary" style="margin-top:18px; display:none; gap:12px;">
        <div style="font-size:18px; font-weight:700;">Total: <span id="cart-total">R$ 0,00</span></div>
        <button id="checkoutBtn" style="background:#111;color:#fff;padding:10px 14px;border-radius:8px;border:0;cursor:pointer;">Finalizar Pedido</button>
        <button id="clearCart" style="background:#eee;color:#111;padding:10px 14px;border-radius:8px;border:0;cursor:pointer;margin-left:8px;">Limpar Carrinho</button>
    </div>

    <div id="empty" style="margin-top:22px;color:#666;display:none;">
        Seu carrinho estÃ¡ vazio. Volte para a <a href="index.html">loja</a>.
    </div>
</main>

<script src="Script.js"></script>
<script>
/* carrinho.html - lÃ³gica de renderizaÃ§Ã£o */
function moneyBRL(v){
    return v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
}

function renderCart(){
    const listEl = document.getElementById('cart-list');
    const summary = document.getElementById('cart-summary');
    const empty = document.getElementById('empty');
    listEl.innerHTML = '';
    let carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];

    if (!carrinho.length) {
        summary.style.display = 'none';
        empty.style.display = 'block';
        return;
    }
    empty.style.display = 'none';
    summary.style.display = 'flex';

    let total = 0;
    carrinho.forEach((item, idx) => {
        const row = document.createElement('div');
        row.style.display = 'flex';
        row.style.gap = '12px';
        row.style.alignItems = 'center';
        row.style.padding = '12px';
        row.style.border = '1px solid #eee';
        row.style.borderRadius = '8px';
        row.style.marginBottom = '10px';
        row.innerHTML = `
            <img src="${item.img}" style="width:90px;height:70px;object-fit:cover;border-radius:6px;">
            <div style="flex:1">
                <div style="font-weight:700">${item.nome}</div>
                <div style="color:#666;font-size:13px">R$ ${Number(item.preco).toFixed(2)} cada</div>
            </div>
            <div style="display:flex;align-items:center;gap:8px">
                <input type="number" min="1" value="${item.qtd}" data-index="${idx}" style="width:64px;padding:6px;border-radius:6px;border:1px solid #ddd;">
                <div style="min-width:90px;text-align:right;font-weight:700">${moneyBRL(item.preco * item.qtd)}</div>
                <button class="remove-item" data-index="${idx}" style="background:#ff6b6b;color:#fff;border:0;padding:8px;border-radius:8px;cursor:pointer;margin-left:8px">Remover</button>
            </div>
        `;
        listEl.appendChild(row);
        total += Number(item.preco) * Number(item.qtd);
    });

    document.getElementById('cart-total').textContent = moneyBRL(total);

    // attach events: quantity change & remove buttons
    listEl.querySelectorAll('input[type="number"]').forEach(input => {
        input.addEventListener('change', (e) => {
            const i = Number(e.target.dataset.index);
            let val = Number(e.target.value) || 1;
            if (val < 1) val = 1;
            let carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];
            carrinho[i].qtd = val;
            localStorage.setItem('carrinho', JSON.stringify(carrinho));
            renderCart();
        });
    });

    listEl.querySelectorAll('.remove-item').forEach(b => {
        b.addEventListener('click', (e) => {
            const i = Number(e.target.dataset.index);
            let carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];
            carrinho.splice(i,1);
            localStorage.setItem('carrinho', JSON.stringify(carrinho));
            renderCart();
        });
    });
}
document.getElementById('checkoutBtn').addEventListener('click', function(){
    let carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];
    if (!carrinho.length) {
        alert("Seu carrinho estÃ¡ vazio!");
        return;
    }

    let mensagem = "OlÃ¡! Gostaria de finalizar meu pedido:%0A%0A";

    let total = 0;

    carrinho.forEach(item => {
        let subtotal = item.preco * item.qtd;
        total += subtotal;
        mensagem += `â€¢ ${item.nome} (x${item.qtd}) - R$ ${subtotal.toFixed(2)}%0A`;
    });

    mensagem += `%0ATotal: R$ ${total.toFixed(2)}%0A%0A`;
    mensagem += "Podemos prosseguir com o pedido?";

    let telefone = "5511984254927";
    let link = `https://api.whatsapp.com/send?phone=${telefone}&text=${mensagem}`;

    window.location.href = link;
});


document.getElementById('clearCart').addEventListener('click', function(){
    if (confirm('Deseja realmente limpar o carrinho?')) {
        localStorage.setItem('carrinho', JSON.stringify([]));
        renderCart();
    }
});

/* inicializa */
renderCart();

/* reusa menu do script.js - caso o script nÃ£o tenha inicializado o menu, iniciamos aqui */
(function attachMenu(){
    const btnMenu = document.getElementById("btnMenu");
    const btnClose = document.getElementById("btnClose");
    const menu = document.getElementById("menu");
    const backdrop = document.getElementById("backdrop");
    if (!btnMenu || !menu || !backdrop) return;
    btnMenu.addEventListener("click", () => {
        menu.classList.add("open"); backdrop.classList.add("show");
    });
    btnClose && btnClose.addEventListener("click", () => {
        menu.classList.remove("open"); backdrop.classList.remove("show");
    });
    backdrop.addEventListener("click", () => {
        menu.classList.remove("open"); backdrop.classList.remove("show");
    });
})();
</script>

</body>
</html>
